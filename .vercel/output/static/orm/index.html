<!DOCTYPE html>
<html lang="en" class="motion-safe:scroll-smooth 2xl:text-[20px]">
	<head>
		<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="https://yuxxeun.now.sh">
<meta name="twitter:creator" content="yuxxeun®">
<meta name="twitter:title" content="yuxxeun®">
<meta name="twitter:description" content="THE LIGHT THAT COMES FROM DOWNSTAIRS">
<meta name="twitter:image" content="https://github.com/yuxxeun/honeypod/blob/main/src/assets/images/gradient.jpg?raw=true">

<script defer host="/umami.js"></script>


<title>ORM: The Abstraction Dilemma — yuxxeun®</title>
<meta name="robots" content="index,follow" />
<meta name="description" content="And, damn, ORM (and MVC pattern) is so over-engineering" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="https://yuxxeun.now.sh" />
<meta name="twitter:creator" content="yuxxeun®" />
<meta property="og:title" content="ORM: The Abstraction Dilemma" />
<meta property="og:description" content="And, damn, ORM (and MVC pattern) is so over-engineering" />
<meta property="og:url" content="https://yuxxeun.now.sh/orm" />
<meta property="og:type" content="lab" />
<meta property="og:image" content="https://yuxxeun.now.sh/assets/orm.264ffe25.png" />
<meta property="og:image:alt" content="ORM: The Abstraction Dilemma" />
<meta property="og:site_name" content="yuxxeun®" />
<link rel="canonical" href="https://yuxxeun.now.sh/orm" />


<!-- Or Google Fonts -->
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.ico">
<link rel="mask-icon" href="/favicon.ico" color="#8D46E7">


	<link rel="stylesheet" href="/assets/_...page_.e8d18889.css" /><script type="module" src="/page.ea7edad8.js"></script>
<script>!(function(w,p,f,c){c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.7.1 - MIT builder.io */
!function(t,e,n,i,r,o,a,d,s,c,p,l){function u(){l||(l=1,"/"==(a=(o.lib||"/~partytown/")+(o.debug?"debug/":""))[0]&&(s=e.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(w,1e4),e.addEventListener("pt0",f),r?h(1):n.serviceWorker?n.serviceWorker.register(a+(o.swPath||"partytown-sw.js"),{scope:a}).then((function(t){t.active?h():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&h()}))}),console.error):w())))}function h(t){c=e.createElement(t?"script":"iframe"),t||(c.setAttribute("style","display:block;width:0;height:0;border:0;visibility:hidden"),c.setAttribute("aria-hidden",!0)),c.src=a+"partytown-"+(t?"atomics.js?v=0.7.1":"sandbox-sw.html?"+Date.now()),e.body.appendChild(c)}function w(t,n){for(f(),t=0;t<s.length;t++)(n=e.createElement("script")).innerHTML=s[t].innerHTML,e.head.appendChild(n);c&&c.parentNode.removeChild(c)}function f(){clearTimeout(d)}o=t.partytown||{},i==t&&(o.forward||[]).map((function(e){p=t,e.split(".").map((function(e,n,i){p=p[i[n]]=n+1<i.length?"push"==i[n+1]?[]:p[i[n]]||{}:function(){(t._ptf=t._ptf||[]).push(i,arguments)}}))})),"complete"==e.readyState?u():(t.addEventListener("DOMContentLoaded",u),t.addEventListener("load",u))}(window,document,navigator,top,window.crossOriginIsolated);</script></head>

	<body class="antialiased text-gray-900 dark:text-slate-300 tracking-tight bg-white dark:bg-black">
		<header class="sticky sm:sticky top-0 z-40 flex-none mx-auto w-full bg-white/30 backdrop-blur-lg md:bg-white/30 dark:bg-black/30 dark:md:bg-black/30 md:backdrop-blur-md border-b-0 dark:border-b-0" id="header">
	<div class="py-3 px-3 mx-auto w-full md:flex md:justify-between max-w-6xl md:px-4">
		<div class="flex justify-between">
			<a class="flex text-2xl font-bold items-center" href="/">
				<span class="self-center ml-2 text-2xl text-gray-900 hover:text-oranged dark:hover:text-oranged whitespace-nowrap font-delight hover:ease-in-out hover:duration-150 transition duration-150 ease-in-linear tracking-tighter uppercase dark:text-white">v1.0.0.1
</span>
			</a>
			<div class="flex items-center md:hidden">
				<button type="button" class="text-gray-500 focus:outline-none dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:ring-4 hover:ring-oranged rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Toggle between Dark and Light mode" data-aw-toggle-color-scheme>
	<svg viewBox="0 0 24 24" class="w-6 h-6" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg>
</button>
				<button type="button" class="ml-1.5 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center transition" aria-label="Toggle Menu" data-aw-toggle-menu>
	<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" class="w-6 h-6" astro-icon="tabler:menu"><g class="icon-tabler" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 8h16"/><path d="M4 16h16"/></g></svg>
</button>
			</div>
		</div>
		<nav class="items-center hidden uppercase font-display tracking-wide w-full md:w-auto md:h-auto md:flex text-black dark:text-white h-screen" aria-label="Main navigation">
			<ul class="flex flex-col pt-8 md:pt-0 md:flex-row md:self-center w-full md:w-auto text-xl md:text-base">
				<li class="hover:ease-in-out hover:duration-150">
					<a class="px-4 py-3 flex hover:text-oranged items-center transition duration-150 ease-in-out" href="/">home</a>
				</li>
				<li class="hover:ease-in-out hover:duration-150">
					<a class="px-4 py-3 flex hover:text-oranged items-center transition duration-150 ease-in-linear" rel="prefetch" href="/lab">laboratory</a>
				</li>
				<li class="md:hidden">
					<a class="hover:text-oranged px-4 py-3 flex items-center transition duration-150 ease-in-out" rel="prefetch" href="https://github.com/yuxxeun">github
					</a>
				</li>
			</ul>
			<div class="md:self-center flex items-center mb-4 md:mb-0 ml-2">
				<div class="hidden items-center md:flex">
					<button type="button" class="text-gray-500 focus:outline-none dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:ring-4 hover:ring-oranged rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Toggle between Dark and Light mode" data-aw-toggle-color-scheme>
	<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg>
</button>
					<!-- <a
						class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center"
						aria-label="RSS Feed"
						href="/rss.xml"
					>
						<Icon name="tabler:rss" class="w-5 h-5" />
					</a>
					<a
						href="https://github.com/yuxxeun"
						class="inline-block text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5"
						aria-label="yuxxeun Github"
					>
						<Icon name="tabler:brand-github" class="w-5 h-5" />
					</a> -->
				</div>
			</div>
		</nav>
	</div>
</header><main>
		<section class="py-8 sm:py-16 lg:py-20 mx-auto">
	<article class="overflow-x-auto">
		<header>
			<p class="max-w-3xl mx-auto font-semibold font-space text-center">
				<time datetime="November 3 2022">Nov 3, 2022</time> &bull; 13 min read
			</p>
			<h1 class="px-4 uppercase text-oranged font-display text-2xl tracking-tight sm:px-6 max-w-3xl mx-auto text-center md:text-5xl font-bold leading-tighter mb-8 mt-4 font-heading">
				ORM: The Abstraction Dilemma
			</h1>
			<picture>
			<source type="image/avif" srcset="/assets/orm.264ffe25_ZglxaB.avif 400w,/assets/orm.264ffe25_1q3Y1D.avif 900w" sizes="(max-width: 900px) 400px, 900px"><source type="image/webp" srcset="/assets/orm.264ffe25_rYgMa.webp 400w,/assets/orm.264ffe25_29oMYp.webp 900w" sizes="(max-width: 900px) 400px, 900px"><source type="image/png" srcset="/assets/orm.264ffe25_2ixgpA.png 400w,/assets/orm.264ffe25_1wPNtJ.png 900w" sizes="(max-width: 900px) 400px, 900px">
			<img width="900" height="506" src="/assets/orm.264ffe25_GonSm.png" loading="lazy" decoding="async" alt="And, damn, ORM (and MVC pattern) is so over-engineering" class="mx-auto mt-4 mb-6 max-w-full bg-gray-400  dark:bg-slate-700 sm:rounded-md lg:max-w-6xl">
		</picture>
		</header>
		<div class="overflow-x-hidden tracking-wide text-black dark:text-white container mx-auto px-6 font-delight sm:px-6 max-w-3xl prose prose-lg lg:prose-xl dark:prose-invert prose-headings:text-oranged prose-md prose-headings:font-extrabold prose-headings:font-heading prose-headings:leading-wide prose-headings:tracking-normal prose-headings:font-delight prose-a:text-oranged prose-img:rounded-md prose-img:shadow-lg mt-8">
			<p>Ditahun 2018, sesuatu yang disebut “transformasi digital” sedang naik daun, dari proses digitasi sampai digitalisasi. Masyarakat dari berbagai lapisan berlomba untuk menerapkan teknologi di berbagai aspek, berkat era informasi ini pada pertengahan abad 21 ini.</p>
<p>Penggunaan personal komputer (PC) sudah relatif banyak namun satu hal yang membuat gelembung ini besar adalah satu: internet. Internet salah satunya dapat menghubungkan penjual emping yang misal berada di Banjarnegara dengan pembeli yang berada di Sragen.</p>
<p>Internet memungkinan sesuatu yang sebelumnya tidak mungkin karena terdapat bingkai pemisah yang bernama geografis.</p>
<p>Jika internet diibaratkan sebuah pulau, alamat IP berarti sebuah tanah kosong. Bangunannya adalah sesuatu yang disebut dengan situs, dan tidak jarang satu bangunan dihuni oleh banyak… penghuni.</p>
<p>Setiap bangunan memiliki rancangan yang berbeda-beda, tergantung si <em>arsitek</em>. Pada sekitaran tahun 2018, kebanyakan bangunan tersebut memiliki rancangan yang sama: dibangun menggunakan sesuatu bernama HTML, CSS, JavaScript, PHP, dan basis data rasional yang kemungkinan besar MySQL. Dan jenis bangunan tersebut ada dua: statis dan dinamis. Perbedaan utamanya pada dasarnya hanyalah sumber data yang diambil untuk menampilkan sebuah halaman situs: apakah langsung dari kode, atau diambil dari sebuah penyimpanan data.</p>
<p>Umumnya, jika jenis situs yang ingin dibuat berjenis aplikasi, situs tersebut kemungkinan besar bersifat dinamis karena adanya interaksi yang dilakukan oleh pengguna dan aplikasi harus bisa menangani interaksi tersebut. Misal, bila aplikasi tersebut memiliki sistem “autentikasi” untuk dapat mengenali siapa pengguna X dengan tanda pengenal Y di aplikasi tersebut, maka si aplikasi harus menyimpan data Y tersebut.</p>
<p>Data tersebut secara teknis bisa disimpan dimana saja, namun yang paling umum adalah di penyimpanan data yang persisten sehingga aplikasi tidak kehilangan data yang sudah dimasukkan sebelumnya oleh si pengguna ketika misalnya aplikasi tersebut mati.</p>
<p>Penyimpanan data yang persisten tersebut biasa disebut dengan basis data atau database. Tidak banyak pilihan database yang bisa digunakan pada kala itu, namun yang paling populer penggunaannya adalah basis data rasional yang salah satunya adalah <a href="https://mariadb.org/about">MySQL</a>.</p>
<p>Karena MySQL juga pada dasarnya adalah sebuah aplikasi, cara agar membuat aplikasi kita bisa berkomunikasi dengan aplikasi lain adalah melalui sesuatu yang disebut dengan <a href="https://en.wikipedia.org/wiki/API"><em>Application Programming Interface</em></a> (API). <em>API</em> biasa memiliki berbagai lapisan tergantung seberapa banyak detail yang ingin disembunyikan atau yang biasa disebut dengan abstraksi.</p>
<p>Dulu gue pernah ingin menjadi seorang “Fullstack Engineer” dan pekerjaan di Front-End kurang lebih adalah melakukan slicing yang sederhananya adalah tentang mengubah berkas PSD ke HTML, berbeda dengan sekarang yang sepertinya harus mengetahui semua lapisan yang ada di OSI model.</p>
<p>Just kidding.</p>
<p>Di bagian back-end, mereka besar kemungkinan bertanggung jawab akan <em>business/domain logic</em> yang sederhananya “mengkodekan” aturan bisnis dunia nyata yang menentukan bagaimana data dapat dibuat, disimpan, dan diubah.</p>
<p>Jika ada kesalahan “logic” yang menyebabkan bisnis rugi 10 milyar karena kegagalan ataupun kesalahan dalam penyimpanan data ke basis data, tidak perlu berpikir lama siapa yang harus disalahkan.</p>
<p>Sekarang kita fokus ke bagian teknis.</p>
<p>Basis data disebut “rasional” salah satunya adalah karena data dipresentasikan dalam bentuk tabel yang mana terdiri dari baris dan kolom. Sistem dari basis data yang rasional ini disebut dengan <em>Relational Database Management System</em> (RDBMS) yang maksudnya, bila basis data tersebut menggunakan RDBMS, cara untuk berinteraksi dengan si database ini menggunakan sesuatu bernama <em>Structured Query Language</em> (SQL).</p>
<p>Kala itu bahasa pemrograman yang gue gunakan adalah PHP: Hypertext Preprocessor. Alasannya? Tuntutan (educational purpose) dan Pasar. Gue kurang mengerti kenapa PHP populer kala itu, yang gue yakin karena alasan ekosistem yang menjadikan pengembang PHP sebagai warga negara kelas satu seperti munculnya Web Hosting khusus untuk Web Server yang bisa menjalankan kode PHP, Content Management System (CMS) yang dibuat menggunakan PHP, dan yang paling penting dukungan PHP terhadap driver MySQL secara native.</p>
<h3 id="php--mysql-in-the-nutshell">PHP + MySQL in the nutshell</h3>
<p>Untuk membuat aplikasi yang dibuat menggunakan PHP dapat berkomunikasi dengan MySQL, kita perlu menghubungkannya terlebih dahulu, yakni melalui API. PHP menawarkan dua cara (jika gue tidak salah ingat) yakni melalui PDO atau langsung menggunakan <em>driver</em> resmi terkait basis data yang digunakan.</p>
<p>Mari kita fokus ke penggunaan <em>driver</em> resmi. Dalam penggunaan driver resminya pun terdapat 2 paradigma yang ada: Prosedural dan object-oriented. Karena gue suka ribet, mari kita pilih cara prosedural.</p>
<p>Untuk menghubungkan aplikasi PHP kita ke basis data MySQL, method dari API yang ada yang bisa kita gunakan adalah <code>mysqli_connect</code> yang umumnya membutuhkan 3 parameter: hostname, username, dan password. Jika parameter hostname ter-definisi, maka komunikasi dengan MySQL harusnya menggunakan TCP daripada via UNIX socket (IPC).</p>
<p>Kode nya kurang lebih seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">$conn </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mysqli_connect</span><span style="color: #C9D1D9">( $hostname, $username, $password );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ( </span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">$conn ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">die</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'connection failed'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">.</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mysqli_connect_error</span><span style="color: #C9D1D9">() );</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">mysqli_close</span><span style="color: #C9D1D9">( $conn );</span></span></code></pre>
<p>Kita akan menggunakan <em>variable</em> <code>$conn</code> tersebut untuk memanggil method lain seperti untuk melakukan <em>query</em> misalnya dengan memanggil <code>mysqli_query</code>. Let’s do it, I guess?</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">$conn </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mysqli_connect</span><span style="color: #C9D1D9">( $hostname, $username, $password );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ( </span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">$conn ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">die</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'connection failed'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">.</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mysqli_connect_error</span><span style="color: #C9D1D9">() );</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">$database_list </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mysqli_query</span><span style="color: #C9D1D9">( $conn, </span><span style="color: #A5D6FF">"show databases"</span><span style="color: #C9D1D9"> );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ( $database_list ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">print_r</span><span style="color: #C9D1D9">( $database_list );</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">mysqli_close</span><span style="color: #C9D1D9">( $conn );</span></span></code></pre>
<p>Hasilnya jika memiliki 4 database, kurang lebih seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    [current_field] </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span></span>
<span class="line"><span style="color: #C9D1D9">    [field_count] </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span></span>
<span class="line"><span style="color: #C9D1D9">    [lengths] </span><span style="color: #FF7B72">=></span></span>
<span class="line"><span style="color: #C9D1D9">    [num_rows] </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">4</span></span>
<span class="line"><span style="color: #C9D1D9">    [type] </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span></span>
<span class="line"><span style="color: #C9D1D9">)</span></span></code></pre>
<p>That’s it.</p>
<h3 id="very-select">Very SELECT</h3>
<p>Cara untuk menampilkan data menggunakan SQL adalah menggunakan statement <code>SELECT</code>. Argumen paling penting dari <code>SELECT</code> ini adalah nama table yang ingin diambil dan daftar kolom yang ingin ditampilkan.</p>
<p>Umumnya kita harus mendefinisikan nama kolom yang ingin diambil karena alasan privasi daripada menggunakan <code>*</code> yang chaotic-evil sehingga menampilkan data lain yang mungkin tidak kita butuhkan dalam konteks tertentu.</p>
<p>Menggunakan statement <code>SELECT</code> di <code>mysqli_query</code> tidak terlalu sulit, mungkin seperti ini dengan konteks kita ingin mengambil data di kolom <code>email</code> dari table <code>users</code>:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">$conn </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mysqli_connect</span><span style="color: #C9D1D9">( $hostname, $username, $password, $dbname );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ( </span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">$conn ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">die</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'connection failed'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">.</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mysqli_connect_error</span><span style="color: #C9D1D9">() );</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">$users </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mysqli_query</span><span style="color: #C9D1D9">( $conn, </span><span style="color: #A5D6FF">"</span><span style="color: #FF7B72">SELECT</span><span style="color: #A5D6FF"> email </span><span style="color: #FF7B72">FROM</span><span style="color: #A5D6FF"> users"</span><span style="color: #C9D1D9"> );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ( </span><span style="color: #D2A8FF">mysqli_num_rows</span><span style="color: #C9D1D9">( $users ) </span><span style="color: #FF7B72">></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9"> ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">while</span><span style="color: #C9D1D9">( $row </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mysqli_fetch_assoc</span><span style="color: #C9D1D9">( $users ) ) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">print_r</span><span style="color: #C9D1D9">( $row );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">mysqli_close</span><span style="color: #C9D1D9">( $conn );</span></span></code></pre>
<p>Diatas kita sudah mendefinisikan <code>$dbname</code> dan juga kita memanggil <code>mysqli_num_rows</code> untuk memastikan bahwa ada data yang bisa kita proses dan juga memanggil <code>mysqli_fetch_assoc</code> untuk menyimpan hasil <em>query</em> yang kita lakukan sebagai <em>associative</em> array.</p>
<p>Hasilnya kurang lebih seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">Array</span></span>
<span class="line"><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    [email] =</span><span style="color: #FF7B72">></span><span style="color: #C9D1D9"> anggun@acme.inc</span></span>
<span class="line"><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">Array</span></span>
<span class="line"><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    [email] =</span><span style="color: #FF7B72">></span><span style="color: #C9D1D9"> kiko@enak.tau</span></span>
<span class="line"><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">Array</span></span>
<span class="line"><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    [email] =</span><span style="color: #FF7B72">></span><span style="color: #C9D1D9"> krido@hey.io </span></span>
<span class="line"><span style="color: #C9D1D9">)</span></span></code></pre>
<p>Sekarang kita ke bagian yang menarik, bagaimana kita ingin mengambil data untuk user <code>anggun@acme.inc</code> saja? Kita bisa menambahkan <code>WHERE</code> didalam sintaks SQL kita sebelumnya!</p>
<p>Tapi sedikit lucu jika menggunakan kolom <code>email</code> sebagai kunci utama. Biasanya kolom yang digunakan sebagai kunci utama adalah <code>id</code> dengan tipe data integer agar bisa di <em>auto increment</em> sehingga data yang disimpan bisa dijamin unik.</p>
<p>Berarti sekarang mari kita ambil data <code>email</code> berdasarkan <code>id</code> dari si <code>users</code> tersebut!</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">$conn </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mysqli_connect</span><span style="color: #C9D1D9">( $hostname, $username, $password, $dbname );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ( </span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">$conn ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">die</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'connection failed'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">.</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mysqli_connect_error</span><span style="color: #C9D1D9">() );</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">$user_id </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1337</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">$user </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mysqli_query</span><span style="color: #C9D1D9">( $conn, </span><span style="color: #A5D6FF">"</span><span style="color: #FF7B72">SELECT</span><span style="color: #A5D6FF"> email </span><span style="color: #FF7B72">FROM</span><span style="color: #A5D6FF"> users </span><span style="color: #FF7B72">where</span><span style="color: #A5D6FF"> id </span><span style="color: #FF7B72">=</span><span style="color: #A5D6FF"> </span><span style="color: #C9D1D9">$user_id</span><span style="color: #A5D6FF">"</span><span style="color: #C9D1D9"> );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ( </span><span style="color: #D2A8FF">mysqli_num_rows</span><span style="color: #C9D1D9">( $user ) </span><span style="color: #FF7B72">></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9"> ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">while</span><span style="color: #C9D1D9">( $row </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mysqli_fetch_assoc</span><span style="color: #C9D1D9">( $user ) ) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">print_r</span><span style="color: #C9D1D9">( $row );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">mysqli_close</span><span style="color: #C9D1D9">( $conn );</span></span></code></pre>
<p>Dan hasilnya kurang lebih seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">Array</span></span>
<span class="line"><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    [email] =</span><span style="color: #FF7B72">></span><span style="color: #C9D1D9"> anggun@acme.inc</span></span>
<span class="line"><span style="color: #C9D1D9">)</span></span></code></pre>
<p>Very ez. Tapi nilai <code>$user_id</code> diatas masih statis, harusnya dinamis entah diambil dari <code>$_GET</code>, <code>$_POST</code> atau bahkan <code>$_COOKIE</code>.</p>
<p>Anggap kita ambil dari <em>cookie</em> dengan <em>key</em> bernama <code>user_id</code> karena jika menggunakan <em>query parameter</em> terlalu jelas. Kode nya seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">$conn </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mysqli_connect</span><span style="color: #C9D1D9">( $hostname, $username, $password, $dbname );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ( </span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">$conn ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">die</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'connection failed'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">.</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mysqli_connect_error</span><span style="color: #C9D1D9">() );</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ( </span><span style="color: #FF7B72">!</span><span style="color: #79C0FF">isset</span><span style="color: #C9D1D9">( $_COOKIE[ </span><span style="color: #A5D6FF">'user_id'</span><span style="color: #C9D1D9"> ] ) ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">die</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'no user_id'</span><span style="color: #C9D1D9"> );</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">$user_id </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> $_COOKIE[ </span><span style="color: #A5D6FF">'user_id'</span><span style="color: #C9D1D9"> ];</span></span>
<span class="line"><span style="color: #C9D1D9">$user </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mysqli_query</span><span style="color: #C9D1D9">( $conn, </span><span style="color: #A5D6FF">"</span><span style="color: #FF7B72">SELECT</span><span style="color: #A5D6FF"> email </span><span style="color: #FF7B72">FROM</span><span style="color: #A5D6FF"> users </span><span style="color: #FF7B72">where</span><span style="color: #A5D6FF"> id </span><span style="color: #FF7B72">=</span><span style="color: #A5D6FF"> </span><span style="color: #C9D1D9">$user_id</span><span style="color: #A5D6FF">"</span><span style="color: #C9D1D9"> );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ( </span><span style="color: #D2A8FF">mysqli_num_rows</span><span style="color: #C9D1D9">( $user ) </span><span style="color: #FF7B72">></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9"> ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">while</span><span style="color: #C9D1D9">( $row </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mysqli_fetch_assoc</span><span style="color: #C9D1D9">( $user ) ) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">print_r</span><span style="color: #C9D1D9">( $row );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">mysqli_close</span><span style="color: #C9D1D9">( $conn );</span></span></code></pre>
<p>Jika nilai <code>$_COOKIE['user_id']</code> adalah <code>1337</code>, maka hasilnya kurang lebih sama seperti yang sebelumnya.</p>
<p>Bagaimana bila nilainya adalah <code>1337 or 1 = 1</code>?</p>
<p>You guessed it right.</p>
<p>(and yes, $_SESSION and/or JWT exist for a reason — just in case)</p>
<h3 id="abstractions">Abstractions</h3>
<p>Meskipun sintaks SQL bersifat deklaratif, jurangnya justru ada di API nya. Ya, PHP memiliki PDO tapi bahasa pemrograman bukan hanya PHP di dunia ini.</p>
<p>Jika kita melihat cuplikan kode diatas, kita bisa membuat abstraksi seperti untuk:</p>
<ul>
<li>membuat koneksi dan menutupnya</li>
<li>menangani data yang didapat dari input pengguna</li>
<li>menangani ketika data yang diminta tidak ada</li>
<li>memberikan ketika data yang diminta ada</li>
</ul>
<p>…terlepas bahasa pemrograman ataupun basis data yang digunakan.</p>
<p>Pseudocode nya mungkin seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">$db </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">DB</span><span style="color: #C9D1D9">( $ENV[ </span><span style="color: #A5D6FF">'DB'</span><span style="color: #C9D1D9"> ] );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ( </span><span style="color: #FF7B72">!</span><span style="color: #79C0FF">isset</span><span style="color: #C9D1D9">( $_COOKIE[ </span><span style="color: #A5D6FF">'user_id'</span><span style="color: #C9D1D9"> ] ) ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">die</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'no user_id'</span><span style="color: #C9D1D9"> );</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">$user </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> $db</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">select</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #A5D6FF">'users'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">array</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'email'</span><span style="color: #C9D1D9"> ),</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">array</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'id'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> $_COOKIE[ </span><span style="color: #A5D6FF">'user_id'</span><span style="color: #C9D1D9"> ] )</span></span>
<span class="line"><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">print_r</span><span style="color: #C9D1D9">( $user );</span></span></code></pre>
<p>Yes, kita bisa buat abstraksi lagi untuk terus menutupi aib yang ada di kode kita yang mungkin menjadi seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ( </span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">isset</span><span style="color: #C9D1D9">( $_COOKIE[ </span><span style="color: #A5D6FF">'user_id'</span><span style="color: #C9D1D9"> ] ) ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">die</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'no user_id'</span><span style="color: #C9D1D9"> );</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">$user </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">User</span><span style="color: #FF7B72">::</span><span style="color: #D2A8FF">find</span><span style="color: #C9D1D9">( $_COOKIE[ </span><span style="color: #A5D6FF">'user_id'</span><span style="color: #C9D1D9"> ], </span><span style="color: #79C0FF">array</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'email'</span><span style="color: #C9D1D9"> ) );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">print_r</span><span style="color: #C9D1D9">( $user );</span></span></code></pre>
<p>Dan, ya, mungkin kamu sedikit familiar dengan sintaks diatas.</p>
<h3 id="the-abstraction-dilemma">The abstraction dilemma</h3>
<p>Bangun tidur cek Twitter ada unpopular opinion tentang <em>ORMs are often overused</em>. Meskipun gue seringnya cuman tertarik bahas unpopular opinion tentang buna raven, but I can’t stand this one.</p>
<p>Yes man, ORMs are often overused. We can literally put a very raw SQL queries on something like <code>/sql.php?query=select * from users --because why not</code> dan sanitization berada di level reverse proxy or something ataupun bisa pakai GraphQL biar lebih gaya.</p>
<p>Tapi sebelum kita julidin ORM, mari kita bahas sedikit apa itu ORM.</p>
<h3 id="object-relational-mapping-orm">Object-relational Mapping (ORM)</h3>
<p>ORM singkatnya adalah sebuah teknik untuk melakukan query dan memanipulasi data dari sebuah database menggunakan paradigma berorientasi objek.</p>
<p>Seperti, untuk memanggil <code>SELECT email FROM users where id = 1337</code> kita bisa hanya dengan memanggil method <code>find</code> dari instance <code>User</code> misalnya seperti <code>User::find( 1337, [ 'email' ] )</code> dan hasilnya terserah ingin kita apa kan.</p>
<p>Yang membedakan ORM dengan <em>“query builder”</em> pada dasarnya hanyalah level abstraksi alias API yang ditawarkan, seperti mungkin kita bisa menggunakan <code>$db->select( 'users', [ 'email' ], [ 'id' => 1337 ] )</code> yang misalnya karena kita tidak percaya dengan apa yang dilakukan oleh method <code>find</code>. Tapi ORM ada bukan karena tanpa alasan, fitur umum yang dijual oleh ORM salah duanya adalah “association” dan “hooks”.</p>
<p>Dengan <em>query builder</em> tentu kita bisa melakukan ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">$db</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">transaction</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">( $db ) {</span></span>
<span class="line"><span style="color: #C9D1D9">    $db</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">insert</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #A5D6FF">'addresses'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">array</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'address'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Jl. Dipayuda'</span><span style="color: #C9D1D9"> )</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    $address_id </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> $db</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">id</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    $db</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">insert</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #A5D6FF">'shipping_address'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">array</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'address'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Jl. Mayjend Panjaitan No.69'</span><span style="color: #C9D1D9"> )</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    $shipping_address_id </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> $db</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">id</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    $db</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">insert</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #A5D6FF">'users'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">array</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #A5D6FF">'name'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'krido'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #A5D6FF">'address_id'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> $address_id,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #A5D6FF">'shipping_address_id'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> $shipping_address_id</span></span>
<span class="line"><span style="color: #C9D1D9">      )</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">$db</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">commit</span><span style="color: #C9D1D9">();</span></span></code></pre>
<p>Dengan ORM, mungkin bisa seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #79C0FF">DB</span><span style="color: #FF7B72">::</span><span style="color: #D2A8FF">transaction</span><span style="color: #C9D1D9">( </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">  $address </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Address</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">array</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'address'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Jl. Dipayuda'</span><span style="color: #C9D1D9"> )</span></span>
<span class="line"><span style="color: #C9D1D9">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  $shipping_address </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">ShippingAddress</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">array</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'address'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Jl. Mayjend Panjaitan No.69'</span><span style="color: #C9D1D9"> )</span></span>
<span class="line"><span style="color: #C9D1D9">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  $user </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">User</span><span style="color: #FF7B72">::</span><span style="color: #D2A8FF">find</span><span style="color: #C9D1D9">( </span><span style="color: #79C0FF">69</span><span style="color: #C9D1D9"> );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  $user</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">address</span><span style="color: #C9D1D9">()</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">save</span><span style="color: #C9D1D9">( $address );</span></span>
<span class="line"><span style="color: #C9D1D9">  $user</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">shipping_address</span><span style="color: #C9D1D9">()</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">save</span><span style="color: #C9D1D9">( $shipping_address );</span></span>
<span class="line"><span style="color: #C9D1D9">} );</span></span></code></pre>
<p>Atau contoh hooks, dengan query builder mungkin kita bisa saja melakukan seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">$db</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">transaction</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">( $db ) {</span></span>
<span class="line"><span style="color: #C9D1D9">    $db</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">delete</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #A5D6FF">'users'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">array</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'user_id'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1337</span><span style="color: #C9D1D9"> )</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    $db</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">delete</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #A5D6FF">'logs'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">array</span><span style="color: #C9D1D9">( </span><span style="color: #A5D6FF">'user_id'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1337</span><span style="color: #C9D1D9"> )</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">$db</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">commit</span><span style="color: #C9D1D9">();</span></span></code></pre>
<p>Dengan ORM, mungkin bisa seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">self::</span><span style="color: #D2A8FF">deleting</span><span style="color: #C9D1D9">( </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">( $user ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  $user</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">logs</span><span style="color: #C9D1D9">()</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">each</span><span style="color: #C9D1D9">( </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> ( $log ) {</span></span>
<span class="line"><span style="color: #C9D1D9">    $log</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">delete</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  } );</span></span>
<span class="line"><span style="color: #C9D1D9">} );</span></span></code></pre>
<p>Ya mungkin tidak sesederhana diatas, tapi semoga mendapat gambarannya.</p>
<h3 id="testing">Testing</h3>
<p>Misal ada kasus: <em>Ambil data artikel yang memiliki id 10</em>, bagaimana kita menulis test untuk skenario diatas?</p>
<p>Kita pasti harus mengsimulasikan basis data yang ada karena tidak mungkin bila menggunakan basis data beneran. Berdasarkan contoh diatas, untuk menandakan bahwa artikel yang diambil adalah yang memiliki id 10 dan bukan 6969, misal pseudocode nya seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">get_article_by_id</span><span style="color: #C9D1D9">( $article_id ) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// ... query to db</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> $article;</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>
<p>Dengan query builder, kemungkinan besar untuk mengetahui apakah yang kita query tersebut “benar” adalah dengan melakukan pencocokan dengan raw query nya, misalnya seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">$query </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> $article</span><span style="color: #FF7B72">-></span><span style="color: #D2A8FF">get_article_by_id</span><span style="color: #C9D1D9">( </span><span style="color: #79C0FF">10</span><span style="color: #C9D1D9"> )</span><span style="color: #FF7B72">-></span><span style="color: #C9D1D9">queryString;</span></span>
<span class="line"><span style="color: #79C0FF">assert</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">  $query,</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #A5D6FF">"</span><span style="color: #FF7B72">SELECT</span><span style="color: #A5D6FF"> id, title, content </span><span style="color: #FF7B72">FROM</span><span style="color: #A5D6FF"> articles </span><span style="color: #FF7B72">WHERE</span><span style="color: #A5D6FF"> id </span><span style="color: #FF7B72">=</span><span style="color: #A5D6FF"> </span><span style="color: #79C0FF">10</span><span style="color: #A5D6FF">"</span></span>
<span class="line"><span style="color: #C9D1D9">);</span></span></code></pre>
<p>Dengan ORM, kita bisa melakukannya misal seperti ini:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">$article </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Article</span><span style="color: #FF7B72">::</span><span style="color: #D2A8FF">find</span><span style="color: #C9D1D9">( </span><span style="color: #79C0FF">10</span><span style="color: #C9D1D9"> );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">assert</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">  $article</span><span style="color: #FF7B72">-></span><span style="color: #C9D1D9">id,</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">10</span></span>
<span class="line"><span style="color: #C9D1D9">);</span></span></code></pre>
<p>Karena dengan ORM kita bisa melakukan seeding data dengan mudah dan hal yang perlu kita gunakan untuk berinteraksi dengan basis data adalah sesuatu bernama “model”.</p>
<h3 id="the-abstraction-dilemma-dilemma">‘The abstraction dilemma’ dilemma</h3>
<p>Sekarang begini, pada akhirnya, kita—sebagai pengembang—pun akan membuat abstraksi.</p>
<p>Ingin support driver berbeda agar ketika menggunakan SQLite dan MySQL bisa menggunakan API yang sama di aplikasi kita? Cute, maybe let’s write our own driver compatibility layer.</p>
<p>Ingin mengatur connection pooling terhadap database yang kita gunakan? Sweet, let’s write one too!</p>
<p>What if we want to use MVC but still want to say fuck you to ORM? Writing models is cheap, let’s write our own FactoryModel base class!</p>
<p>Also, input sanitization.</p>
<p>And parameter interpolation might sound sexy too!</p>
<p>Gue mendingan nulis library gue sendiri (dan nulis test + dokumentasi + maintain + fix bug + rilis + update deps) daripada harus menarik barang random dari internet yang berukuran 291kB hanya untuk sesuatu bernama ORM ini (plus harus mengingat API yang ada di docs yang enggak banget buat level gue).</p>
<p>And, damn, ORM (and MVC pattern) is so over-engineering. Apa susahnya coba pas pengguna klik tombol login, kirim <code>SELECT email, password FROM users WHERE email = (email_input) and password = bcrypt(sha256(md5((password_input))), (very_salt))</code> mungkin di payload POST, proses whatever yang didapat dari response backend, and that’s that.</p>
<p>Data pengguna yang ada di basis data kita kan milik pengguna juga, dengan bantuan “row-level security” mungkin harusnya oke oke aja klo interface yang digunakan user adalah SQL editor (atau bisa stream SQL query via netcat or something).</p>
<p>Dan hey, sekarang 2022 dan RDBMS itu terlalu kuno. Kita punya firebase, supabase, fauna, mongodb, couchdb, anything yang mana memiliki nice API dan very serverless.</p>
<p>Oh, kita juga ada Ethereum Blockchain sekarang.</p>
<p>Pengetahuan tentang ORM lo akan kadaluarsa karena web3 is the future, database scaling for internet-scale is hard (good luck in using vitess &#x26; cockroachdb) and the future is now.</p>
<h3 id="penutup">Penutup</h3>
<p>Gue mengerti maksud dan tujuan menghindari ORM adalah untuk menghindari overhead (yang mungkin tidak seberapa) dan yang paling penting agar siapapun ingin melihat ke lower-level view dengan menulis sintaks raw SQL agar siapaun tahu apa yang dia lakukan mungkin untuk mencegah “script kiddies problem”.</p>
<p>Dan, ya, ORM is overused. Hampir setiap framework dari mirco sampai macro pasti menawarkan ORM sekalipun mungkin kita tidak membutuhkannya.</p>
<p>Dari pengalaman gue yang pernah menulis raw SQL query, menggunakan query builder, sampai ke penggunaan ORM, yang paling cocok dengan gue adalah tidak berinteraksi dengan basis data sama sekali.</p>
<p>That’s why I’m here, as a Frontend Engineer.</p>
<p>Just kidding.</p>
<p>JIKA GUE HANYA MEMENTINGKAN EGO, GUE LEBIH SUKA QUERY BUILDER. JARI GUE PEGEL HARUS NAHAN SHIFT TIAP KALI NGETIK SELECT, FROM, ORDER BY, WHERE, JOIN, BLABLABLA SEKALIPUN TIDAK WAJIB DITULIS DENGAN FORMAT UPPERCASE (SEPERTI YANG ADA DI BAGIAN LIMITATIONS DI MIT LICENSE) SEPERTI INI DAN JUGA GUE MALES BUKA DOKUMENTASI BUAT MENGINGAT API APA AJA YANG BISA DIGUNAKAN DI ORM YANG GUE GUNAKAN.</p>
<p>TAPI MENULIS KODE (ATAU LEBIH SPESIFIKNYA MENGEMBANGKAN APLIKASI) ADALAH SEBUAH KERJA SAMA TIM. KITA TIDAK BISA MEMAKSA ORANG LAIN UNTUK MENYESUAIKAN DENGAN SELERA KITA APALAGI SAMPAI MENJADI BAGIAN DARI “ENGINEERING CULTURE” HANYA KARENA GUE LEAD DI ORGANISASI TERSEBUT, MISALNYA.</p>
<p>GUE SEDANG TIDAK TERIAK BY THE WAY.</p>
<p>SEBAGAI PENUTUP, UNTUK PERTANYAAN TO ORM OR NOT TO, JAWABANNYA ADALAH ✨TERGANTUNG✨.</p>
<p>SEKIAN.</p>
		</div>
		<div class="container font-space mx-auto px-8 sm:px-6 max-w-3xl mt-8">
			<ul class="text-sm">
			<li class="mr-2 mb-2 inline-block rounded-md bg-gray-200 py-0.5 px-2 dark:bg-slate-700">
					<a href="/tag/software-engineering">software engineering</a>
				</li>
		</ul>
		</div>
	</article>
</section>
	</main><footer class="border-t font-delight border-black dark:border-white">
	<div class="max-w-6xl x-10 mx-auto px-4 sm:px-6">
		<div class="md:flex md:items-center md:justify-between py-6 md:py-8">
			<ul class="flex mb-4 md:order-1 -ml-2 md:ml-4 md:mb-0">
				<li>
					<a class="hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Github" href="https://github.com/yuxxeun">
						<svg viewBox="0 0 24 24" class="w-6 h-6 text-oranged" astro-icon="tabler:brand-github"><title>github</title><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
					</a>
				</li>
				<li>
					<a class="hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Area 13" href="https://github.com/valinatic">
						<svg viewBox="0 0 24 24" class="w-6 h-6 text-oranged" astro-icon="tabler:cpu"><title>init(8)</title><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><rect width="14" height="14" x="5" y="5" rx="1"/><path d="M9 9h6v6H9zM3 10h2M3 14h2M10 3v2M14 3v2M21 10h-2M21 14h-2M14 21v-2M10 21v-2"/></g></svg>
					</a>
				</li>
				<li>
					<a class="hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Bookmarks" href="/bookmark">
						<svg viewBox="0 0 24 24" disable="true" class="w-6 h-6 text-oranged" astro-icon="tabler:book"><title>bookmarks</title><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19a9 9 0 0 1 9 0 9 9 0 0 1 9 0M3 6a9 9 0 0 1 9 0 9 9 0 0 1 9 0M3 6v13M12 6v13M21 6v13"/></g></svg>
					</a>
				</li>
				<li>
					<a class="hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="RSS" href="/rss.xml">
						<svg viewBox="0 0 24 24" class="w-6 h-6 text-oranged" astro-icon="tabler:rss"><title>RSS</title><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0 1 16 16M4 11a9 9 0 0 1 9 9"/></g></svg>
					</a>
				</li>
			</ul>
			<div class="text-md uppercase tracking-wide text-black mr-4 dark:text-white">
				the light that comes from downstairs
			</div>
		</div>
	</div>
</footer>
		<script>
	// Set "light" theme as default
	// if (!localStorage.theme) {
	//   localStorage.theme = "light";
	// }

	if (
		localStorage.theme === 'dark' ||
		(!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
	) {
		document.documentElement.classList.add('dark')
	} else {
		document.documentElement.classList.remove('dark')
	}

	function attachEvent(selector, event, fn) {
		const matches = document.querySelectorAll(selector)
		if (matches && matches.length) {
			matches.forEach((elem) => {
				elem.addEventListener(event, () => fn(elem), false)
			})
		}
	}

	window.onload = function () {
		attachEvent('[data-aw-toggle-menu]', 'click', function (elem) {
			elem.classList.toggle('expanded')
			document.body.classList.toggle('overflow-hidden')
			document.getElementById('header')?.classList.toggle('h-screen')
			document.querySelector('#header nav')?.classList.toggle('hidden')
		})

		attachEvent('[data-aw-toggle-color-scheme]', 'click', function () {
			document.documentElement.classList.toggle('dark')
			localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light'
		})
	}
	window.onpageshow = function () {
		const elem = document.querySelector('[data-aw-toggle-menu]')
		if (elem) {
			elem.classList.remove('expanded')
		}
		document.body.classList.remove('overflow-hidden')
		document.getElementById('header')?.classList.remove('h-screen')
		document.querySelector('#header nav')?.classList.add('hidden')
	}
</script>

		
	</body>
</html>